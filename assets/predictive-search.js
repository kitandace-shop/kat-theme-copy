class PredictiveSearch extends HTMLElement{constructor(){super(),this.input=this.querySelector('input[type="search"]'),this.predictiveSearchResults=this.querySelector("#predictive-search"),this.searchOverlay=document.querySelector("#search-overlay"),this.resourcesType=this.input.dataset.resourcesType,this.mobileDisable=this.input.dataset.mobileDisable,"false"==this.mobileDisable&&this.input.addEventListener("input",this.debounce((e=>{this.onChange(e)}),300).bind(this))}changeSwatch(e){const t=".card--product",s="selected";if(!e.classList.contains(s)){e.closest(".card__content").querySelector(".card__link").href=e.dataset.swatchUrl;e.closest(".card__color-swatches").querySelector(`.${s}`).classList.remove(s),e.classList.add(s);const r=e.dataset.imageSrc,c=e.dataset.imageSrc2;if(void 0!==r){const s=e.dataset.desktopMedia,c=e.dataset.desktopSrcset,a=e.dataset.mobileSrcset,i=e.dataset.imageSrcset,o=e.closest(t).querySelector(".card__image-wrapper .card__image--primary").querySelector("picture"),n=o.querySelector(".card__product-image.image--primary");o.querySelectorAll("source").forEach(((e,t)=>{switch(t){case 0:e.media=s,e.srcset=c;break;case 1:e.srcset=a}})),n.src=r,n.srcset=i}if(void 0!==c){const s=e.dataset.desktopMedia2,r=e.dataset.desktopSrcset2,a=e.dataset.mobileSrcset2,i=e.dataset.imageSrcset2,o=e.closest(t).querySelector(".card__image-wrapper .card__image--secondary").querySelector("picture"),n=o.querySelector(".card__product-image.image--secondary");o.querySelectorAll("source").forEach(((e,t)=>{switch(t){case 0:e.media=s,e.srcset=r;break;case 1:e.srcset=a}})),n.src=c,n.srcset=i}}}listenForImageEvents(e){const t=e.querySelector(".card__link"),s=e.querySelector(".card__image-wrapper");window.innerWidth>1024&&(window.matchMedia&&window.matchMedia("(pointer:coarse)").matches||(t.addEventListener("mouseover",(()=>{s.classList.add("hover")})),t.addEventListener("mouseout",(()=>{s.classList.remove("hover")}))))}onChange(){const e=this.input.value.trim();e.length?this.getSearchResults(e,this.resourcesType):this.close()}getSearchResults(e,t){fetch(`/search/suggest?q=${e}&resources[type]=${t}&resources[limit]=10&section_id=predictive-search`).then((e=>{if(!e.ok){var t=new Error(e.status);throw this.close(),t}return e.text()})).then((e=>{const t=(new DOMParser).parseFromString(e,"text/html").querySelector("#shopify-section-predictive-search").innerHTML;this.predictiveSearchResults.innerHTML=t,this.open();document.querySelectorAll(".card__swatch--color-option").forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation();const t=e.currentTarget;this.changeSwatch(t)})),e.addEventListener("keydown",(e=>{if(e.stopPropagation(),"Enter"===e.key){const t=e.currentTarget;this.changeSwatch(t)}}))})),document.querySelectorAll(".card--product").forEach((e=>{this.listenForImageEvents(e)}))})).catch((e=>{throw this.close(),e}))}open(){this.predictiveSearchResults.style.display="block",this.searchOverlay.style.display="block"}close(){this.predictiveSearchResults.style.display="none",this.searchOverlay.style.display="none"}debounce(e,t){let s;return(...r)=>{clearTimeout(s),s=setTimeout((()=>e.apply(this,r)),t)}}}customElements.define("iam-predictive-search",PredictiveSearch);